<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>沢宮いうら | 動画クリエイター ポートフォリオサイト</title>
    <link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>🎬</text></svg>">
    <!-- Google Fonts: Noto Sans JP -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+JP:wght@400;700&display=swap" rel="stylesheet">
    <!-- Font Awesome (Icons) -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css">
    <!-- Animate On Scroll (AOS) Library -->
    <link rel="stylesheet" href="https://unpkg.com/aos@next/dist/aos.css" />
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @keyframes aurora {
            0% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
            100% { background-position: 0% 50%; }
        }
        html {
            scroll-behavior: smooth;
        }
        body {
            font-family: 'Noto Sans JP', sans-serif;
            background-color: #0F172A; /* slate-900 */
            color: #cbd5e1; /* slate-300 */
        }
        .aurora-bg {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: -1;
            background: linear-gradient(-45deg, #1e3a8a, #3b0764, #0891b2, #1d4ed8);
            background-size: 400% 400%;
            animation: aurora 20s ease infinite;
            filter: blur(80px);
            opacity: 0.4;
        }
        /* アクティブなナビ/フィルターボタンのスタイル */
        .nav-btn.active,
        .filter-btn.active {
            background-color: #0ea5e9; /* sky-500 */
            color: #ffffff;
            box-shadow: 0 0 15px rgba(14, 165, 233, 0.5);
        }
        .nav-btn:not(.active):hover {
            background-color: #334155; /* slate-700 */
        }
        /* 動画カードのホバーエフェクト */
        .card-hover-effect::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            border-radius: 0.5rem; /* rounded-lg */
            border: 2px solid transparent;
            background: linear-gradient(120deg, #818cf8, #38bdf8, #f472b6, #818cf8) border-box;
            -webkit-mask: linear-gradient(#fff 0 0) padding-box, linear-gradient(#fff 0 0);
            -webkit-mask-composite: destination-out;
            mask-composite: exclude;
            opacity: 0;
            transition: opacity 0.3s ease-in-out;
            pointer-events: none; /* Make it unclickable */
        }
        .card-hover-effect:hover::before {
            opacity: 1;
        }
        /* Hide scrollbar for category tabs */
        #category-filters::-webkit-scrollbar {
            display: none;
        }
        #category-filters {
            -ms-overflow-style: none;  /* IE and Edge */
            scrollbar-width: none;  /* Firefox */
        }
    </style>
</head>
<body class="text-slate-300">
    <div class="aurora-bg"></div>

    <!-- ヘッダー -->
    <header class="bg-slate-900/70 backdrop-blur-xl shadow-lg shadow-black/20 sticky top-0 z-50">
        <div class="container mx-auto px-6 py-4 flex flex-col sm:flex-row sm:items-center sm:justify-between">
            <div>
                <h1 class="text-3xl font-bold text-sky-400">Iura Sawamiya Portfolio</h1>
                <p class="text-lg text-slate-400">想いをカタチにする映像制作</p>
            </div>
            <nav id="main-nav" class="mt-4 sm:mt-0 flex-shrink-0">
                <div class="inline-flex items-center gap-2 p-1 bg-slate-800/60 rounded-lg">
                    <button data-page="works-page" class="nav-btn active whitespace-nowrap px-4 py-2 text-sm font-semibold rounded-md transition-colors duration-300">制作実績</button>
                    <button data-page="flow-page" class="nav-btn whitespace-nowrap px-4 py-2 text-sm font-semibold rounded-md transition-colors duration-300">制作フロー</button>
                </div>
            </nav>
        </div>
    </header>

    <!-- プロフィールセクション -->
    <section class="relative py-24 text-white" style="background-image: url('cover.png'); background-size: cover; background-position: center;">
        <div class="absolute inset-0 bg-black/60 backdrop-blur-sm"></div>
        <div class="container relative mx-auto px-6 text-center" data-aos="fade-down" data-aos-duration="1000">
            <img class="w-32 h-32 rounded-full mx-auto mb-4 border-4 border-slate-500 shadow-lg object-cover" src="profile.png" alt="プロフィール画像">
            <h2 class="text-4xl font-bold text-white mb-2">沢宮いうら</h2>
            <p class="text-slate-200 mb-6 max-w-2xl mx-auto leading-relaxed">
                After Effectsを軸に、心に残るモーショングラフィックスと映像編集を提供します。<br>
                『歌ってみた』MV、MAD、ボイスコミックなど、ジャンルを問わず幅広い制作に対応。<br>
                最新の制作実績やメイキングはXで随時更新しています。<br>
                ご依頼・ご相談は、下のアイコンからお気軽にご連絡ください。
            </p>

            <!-- 実績カウンターと対応ジャンル -->
            <div class="max-w-2xl mx-auto mb-8">
                <!-- カウンター -->
                <div class="flex justify-center gap-x-8 gap-y-4 mb-6" id="category-counts">
                    <!-- JSがここに実績数を挿入します -->
                </div>
                <!-- その他対応可能ジャンル -->
                <div>
                    <h3 class="text-lg font-semibold text-sky-400 mb-3">幅広いジャンルに対応</h3>
                    <p class="text-sm text-slate-300 mb-4">MV制作以外にも、企業案件として下記ジャンルの制作経験がございます。</p>
                    <div class="flex flex-wrap justify-center gap-2">
                        <span class="bg-slate-700/50 text-slate-300 text-xs font-semibold px-3 py-1 rounded-full">アニメ切り抜き</span>
                        <span class="bg-slate-700/50 text-slate-300 text-xs font-semibold px-3 py-1 rounded-full">アニメ配信切り抜き</span>
                        <span class="bg-slate-700/50 text-slate-300 text-xs font-semibold px-3 py-1 rounded-full">ボイスコミック</span>
                        <span class="bg-slate-700/50 text-slate-300 text-xs font-semibold px-3 py-1 rounded-full">MAD</span>
                        <span class="bg-slate-700/50 text-slate-300 text-xs font-semibold px-3 py-1 rounded-full">商品紹介</span>
                    </div>
                </div>
            </div>

            <!-- SNS・連絡先リンク -->
            <div class="flex justify-center items-center space-x-8">
                <a href="https://x.com/iura_sawamiya" target="_blank" rel="noopener noreferrer" class="text-slate-300 hover:text-sky-400 transition-colors duration-300" aria-label="X">
                    <i class="fa-brands fa-x-twitter fa-2x"></i>
                </a>
                <a href="mailto:iura.sawamiya@gmail.com" class="text-slate-300 hover:text-sky-400 transition-colors duration-300" aria-label="Email">
                    <i class="fa-solid fa-envelope fa-2x"></i>
                </a>
            </div>
        </div>
    </section>

    <!-- 制作実績ページ -->
    <main id="works-page" class="page-content container mx-auto px-6 py-12">
        <h2 class="text-3xl font-bold text-center text-white mb-2" data-aos="fade-up">制作実績</h2>
        <p class="mb-8 text-center text-slate-400" data-aos="fade-up" data-aos-delay="100">これまでに制作を担当した作品の一部です。カテゴリや年で絞り込んでご覧いただけます。</p>

        <!-- フィルターセクション -->
        <div class="flex flex-col md:flex-row md:items-center md:justify-between gap-4 mb-10" data-aos="fade-up" data-aos-delay="200">
            <!-- カテゴリタブ -->
            <div id="category-filters" class="flex items-center gap-2 p-1 bg-slate-800/60 backdrop-blur-xl rounded-lg shadow-lg shadow-black/20 overflow-x-auto">
                <button class="filter-btn active whitespace-nowrap px-4 py-2 rounded-md text-sm font-semibold transition-all duration-300" data-filter="all">すべて</button>
                <button class="filter-btn whitespace-nowrap px-4 py-2 text-slate-300 hover:bg-slate-700/50 rounded-md text-sm font-semibold transition-all duration-300" data-filter="uta-full">MV (Full)</button>
                <button class="filter-btn whitespace-nowrap px-4 py-2 text-slate-300 hover:bg-slate-700/50 rounded-md text-sm font-semibold transition-all duration-300" data-filter="uta-short">MV (Short)</button>
                <button class="filter-btn whitespace-nowrap px-4 py-2 text-slate-300 hover:bg-slate-700/50 rounded-md text-sm font-semibold transition-all duration-300" data-filter="illust">Illustrated video</button>
            </div>

            <!-- 年フィルタードロップダウン -->
            <div class="relative" id="year-filter-container">
                <button id="year-filter-button" class="flex items-center justify-between w-full md:w-44 px-4 py-2 bg-slate-800/60 backdrop-blur-xl rounded-lg shadow-lg shadow-black/20 text-slate-300 hover:bg-slate-700/80 transition-colors duration-300">
                    <span id="year-filter-label" class="font-semibold">すべての年</span>
                    <i class="fa-solid fa-chevron-down text-xs transition-transform duration-300 ml-2"></i>
                </button>
                <div id="year-filter-options" class="hidden absolute top-full right-0 mt-2 w-full md:w-44 bg-slate-800 rounded-lg shadow-2xl z-20 overflow-hidden" data-aos="fade-in" data-aos-duration="200">
                    <!-- JSがここにオプションを生成します -->
                </div>
            </div>
        </div>

        <!-- 動画リストがここに挿入されます -->
        <div id="video-list" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8">
            <!-- ローディング中の表示 -->
            <div id="loading" class="col-span-full flex justify-center items-center py-10">
                <div class="w-12 h-12 rounded-full animate-spin border-4 border-solid border-sky-500 border-t-transparent"></div>
            </div>
        </div>
    </main>

    <!-- 制作フローページ -->
    <main id="flow-page" class="page-content hidden container mx-auto px-6 py-12">
        <h2 class="text-3xl font-bold text-center text-white mb-2" data-aos="fade-up">制作フロー</h2>
        <p class="mb-12 text-center text-slate-400" data-aos="fade-up" data-aos-delay="100">ご依頼から納品までの基本的な流れをご説明します。</p>
        
        <div class="max-w-3xl mx-auto">
            <!-- 動画制作の流れ -->
            <div class="mb-16">
                <h3 class="text-2xl font-bold text-sky-400 mb-8 text-center" data-aos="fade-up">動画制作の流れ</h3>
                <div class="relative">
                    <div class="absolute left-6 top-0 h-full w-0.5 bg-slate-700/50" aria-hidden="true"></div>
                    <div class="space-y-12">
                        <!-- Step 1 -->
                        <div class="relative pl-16" data-aos="fade-up" data-aos-delay="200">
                            <div class="absolute -left-0 top-0 flex items-center justify-center w-12 h-12 bg-slate-800 text-sky-400 rounded-full ring-4 ring-slate-900">
                                <i class="fa-solid fa-lightbulb text-xl"></i>
                            </div>
                            <div class="bg-slate-800/50 p-6 rounded-lg shadow-lg">
                                <h4 class="text-xl font-semibold text-white mb-2">Step 1: ラフ制作と方向性の確認</h4>
                                <p class="text-slate-300">まず、動画全体の方向性を決めるために、ワンコーラス分のラフ動画を制作します。もし具体的な完成イメージがあれば、参考動画やイラストなど、どんな形でも構いませんのでぜひ共有してください。この段階ではスピードを重視するため、ラフな品質でのご提出となります。</p>
                                <p class="text-xs text-slate-400 mt-2">目安期間: 1〜2週間</p>
                            </div>
                        </div>
                        <!-- Step 2 -->
                        <div class="relative pl-16" data-aos="fade-up" data-aos-delay="300">
                           <div class="absolute -left-0 top-0 flex items-center justify-center w-12 h-12 bg-slate-800 text-sky-400 rounded-full ring-4 ring-slate-900">
                               <i class="fa-solid fa-comments text-xl"></i>
                           </div>
                            <div class="bg-slate-800/50 p-6 rounded-lg shadow-lg">
                                <h4 class="text-xl font-semibold text-white mb-2">Step 2: フィードバックと修正</h4>
                                <p class="text-slate-300">ラフ動画をご確認いただき、修正点を伺います。「もっとこうしたい」というご意見大歓迎です！最高の作品を一緒に作り上げるため、ご納得いただけるまで何度でも修正いたします。</p>
                            </div>
                        </div>
                        <!-- Step 3 -->
                        <div class="relative pl-16" data-aos="fade-up" data-aos-delay="400">
                            <div class="absolute -left-0 top-0 flex items-center justify-center w-12 h-12 bg-slate-800 text-sky-400 rounded-full ring-4 ring-slate-900">
                                <i class="fa-solid fa-film text-xl"></i>
                            </div>
                            <div class="bg-slate-800/50 p-6 rounded-lg shadow-lg">
                                <h4 class="text-xl font-semibold text-white mb-2">Step 3: フルバージョンの制作</h4>
                                <p class="text-slate-300">動画の方向性が固まったら、フルバージョンの制作に入ります。制作が難航しそうな場合は事前にご相談しますが、進捗は最低でも週に1回ご報告します。その都度、気になる点があればお気軽にご意見ください。</p>
                                <p class="text-xs text-slate-400 mt-2">目安期間: 1〜2週間</p>
                            </div>
                        </div>
                        <!-- Step 4 -->
                        <div class="relative pl-16" data-aos="fade-up" data-aos-delay="500">
                             <div class="absolute -left-0 top-0 flex items-center justify-center w-12 h-12 bg-slate-800 text-sky-400 rounded-full ring-4 ring-slate-900">
                                <i class="fa-solid fa-check-double text-xl"></i>
                             </div>
                             <div class="bg-slate-800/50 p-6 rounded-lg shadow-lg">
                                <h4 class="text-xl font-semibold text-white mb-2">Step 4: 最終確認と仕上げ</h4>
                                <p class="text-slate-300">完成したフルバージョンの動画をご確認いただき、最終調整を行います。こちらもラフ制作時と同様、ご満足いただけるまで丁寧に対応します。</p>
                            </div>
                        </div>
                        <!-- Step 5 -->
                        <div class="relative pl-16" data-aos="fade-up" data-aos-delay="600">
                            <div class="absolute -left-0 top-0 flex items-center justify-center w-12 h-12 bg-slate-800 text-sky-400 rounded-full ring-4 ring-slate-900">
                                <i class="fa-solid fa-paper-plane text-xl"></i>
                            </div>
                            <div class="bg-slate-800/50 p-6 rounded-lg shadow-lg">
                                <h4 class="text-xl font-semibold text-white mb-2">Step 5: 高画質データで納品</h4>
                                <p class="text-slate-300">すべての調整が完了したら、最終版を高画質・高音質データで書き出して納品します。制作途中のご確認用動画は、やり取りをスムーズにするため軽量なデータでお送りしますが、最終納品物は最高品質ですのでご安心ください。</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- ご依頼について -->
            <div class="grid md:grid-cols-2 gap-8">
                <!-- ご依頼方法 -->
                <div class="relative bg-slate-800/60 backdrop-blur-xl rounded-lg shadow-lg p-6 card-hover-effect" data-aos="fade-up" data-aos-delay="200">
                    <h4 class="font-bold text-xl text-white mb-3 flex items-center"><i class="fa-solid fa-paper-plane text-sky-500 mr-3"></i>ご依頼について</h4>
                    <p class="text-slate-300 text-sm">まずはお気軽にXのDMなどからご連絡ください。最高の作品を一緒に作るため、スムーズな意思疎通を第一に考えています。そのため、少しくだけた雰囲気でコミュニケーションできると嬉しいです。</p>
                </div>
                <!-- 納期・活動時間 -->
                <div class="relative bg-slate-800/60 backdrop-blur-xl rounded-lg shadow-lg p-6 card-hover-effect" data-aos="fade-up" data-aos-delay="300">
                    <h4 class="font-bold text-xl text-white mb-3 flex items-center"><i class="fa-solid fa-clock text-sky-500 mr-3"></i>納期とコミュニケーション</h4>
                     <ul class="text-slate-300 text-sm space-y-2">
                        <li><strong class="text-white">納期:</strong> ご依頼時点のスケジュールを基に、着手時期と納期の目安をご提案します。一緒に最適な進行を調整できれば幸いです。</li>
                        <li><strong class="text-white">活動時間:</strong> 主な活動時間は毎日【早朝2時〜夕方18時】です。この時間帯は特に迅速な対応が可能です。</li>
                        <li><strong class="text-white">返信:</strong> 基本的に24時間以内に返信します。3日以上経っても返信がない場合は、通知を見逃している可能性があるため、お手数ですが再度ご連絡ください。</li>
                    </ul>
                </div>
            </div>
        </div>
    </main>

    <!-- フッター -->
    <footer class="bg-slate-900/70 backdrop-blur-xl mt-12 py-6">
        <div class="container mx-auto px-6 text-center text-slate-500">
            <p>&copy; 2025 Iura Sawamiya. All Rights Reserved.</p>
        </div>
    </footer>

    <!-- トップへ戻るボタン -->
    <button id="to-top-button" title="トップへ戻る"
        class="hidden fixed bottom-5 right-5 z-50 p-3 bg-sky-600/80 text-white rounded-full shadow-lg hover:bg-sky-500 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-offset-slate-900 focus:ring-sky-500 backdrop-blur-sm transition-all duration-300">
        <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 15l7-7 7 7" />
        </svg>
    </button>

    <!-- AOS JS -->
    <script src="https://unpkg.com/aos@next/dist/aos.js"></script>
    <script>
      AOS.init({
          once: true,
      });
    </script>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const mainNav = document.getElementById('main-nav');
            const pages = document.querySelectorAll('.page-content');
            const toTopButton = document.getElementById('to-top-button');
            
            // --- ページ切り替えロジック ---
            mainNav.addEventListener('click', (e) => {
                if (!e.target.classList.contains('nav-btn')) return;

                const targetPageId = e.target.dataset.page;
                
                pages.forEach(page => {
                    page.classList.toggle('hidden', page.id !== targetPageId);
                });

                mainNav.querySelector('.active').classList.remove('active');
                e.target.classList.add('active');

                // ページを切り替えたらトップにスクロール
                window.scrollTo(0, 0);
                AOS.refresh(); // 新しいページでAOSアニメーションを再トリガー
            });

            // --- トップへ戻るボタン ---
            window.addEventListener('scroll', () => {
                if (window.pageYOffset > 300) { toTopButton.classList.remove('hidden'); } 
                else { toTopButton.classList.add('hidden'); }
            });
            toTopButton.addEventListener('click', () => {
                window.scrollTo({ top: 0, behavior: 'smooth' });
            });

            // --- 制作実績ページのロジック ---
            const worksPage = document.getElementById('works-page');
            if (worksPage) {
                const videoList = worksPage.querySelector('#video-list');
                const loadingMessage = worksPage.querySelector('#loading');
                const categoryFilterContainer = worksPage.querySelector('#category-filters');
                const yearFilterContainer = worksPage.querySelector('#year-filter-container');
                const yearFilterButton = worksPage.querySelector('#year-filter-button');
                const yearFilterLabel = worksPage.querySelector('#year-filter-label');
                const yearFilterOptions = worksPage.querySelector('#year-filter-options');
                
                let allVideos = [];
                let currentCategory = 'all';
                let currentYear = 'all';

                fetch('videos.csv')
                    .then(response => {
                        if (!response.ok) throw new Error('CSVファイルの読み込みに失敗しました。');
                        return response.text();
                    })
                    .then(csvText => {
                        allVideos = parseCSV(csvText);
                        if (loadingMessage) loadingMessage.style.display = 'none';
                        if (allVideos.length === 0) {
                            if (videoList) videoList.innerHTML = '<p class="text-center col-span-full">表示する動画がありません。</p>';
                            return;
                        }
                        updateProfileStats(allVideos);
                        setupFilters();
                        renderVideos();
                    })
                    .catch(error => {
                        console.error(error);
                        if (loadingMessage) loadingMessage.style.display = 'none';
                        if (videoList) videoList.innerHTML = `<p class="text-center col-span-full text-red-400">${error.message}</p>`;
                    });
                
                function updateProfileStats(videos) {
                    const countsContainer = document.getElementById('category-counts');
                    if (!countsContainer) return;

                    const counts = {
                        'uta-full': 0,
                        'uta-short': 0,
                        'illust': 0
                    };

                    videos.forEach(video => {
                        if (counts.hasOwnProperty(video.category)) {
                            counts[video.category]++;
                        }
                    });

                    const statsHTML = `
                        <div class="text-center">
                            <span class="block text-2xl font-bold text-white">${counts['uta-full']}</span>
                            <span class="text-sm text-slate-400">MV (Full)</span>
                        </div>
                        <div class="text-center">
                            <span class="block text-2xl font-bold text-white">${counts['uta-short']}</span>
                            <span class="text-sm text-slate-400">MV (Short)</span>
                        </div>
                        <div class="text-center">
                            <span class="block text-2xl font-bold text-white">${counts['illust']}</span>
                            <span class="text-sm text-slate-400">Illustrated video</span>
                        </div>
                    `;
                    
                    countsContainer.innerHTML = statsHTML;
                }

                function setupFilters() {
                    const years = [...new Set(allVideos.map(v => new Date(v.published_date).getFullYear()))]
                        .sort((a, b) => b - a);
                    
                    const baseOptionClasses = "block w-full text-left px-4 py-2 text-sm text-slate-300 hover:bg-sky-500 hover:text-white transition-colors duration-200";
                    
                    let yearOptionsHTML = `<button class="${baseOptionClasses}" data-filter="all">すべての年</button>`;
                    years.forEach(year => {
                        yearOptionsHTML += `<button class="${baseOptionClasses}" data-filter="${year}">${year}年</button>`;
                    });

                    if (yearFilterOptions) yearFilterOptions.innerHTML = yearOptionsHTML;
                }

                function renderVideos() {
                    if (!videoList) return;
                    const filteredVideos = allVideos.filter(video => {
                        const videoYear = new Date(video.published_date).getFullYear().toString();
                        const categoryMatch = currentCategory === 'all' || video.category === currentCategory;
                        const yearMatch = currentYear === 'all' || videoYear === currentYear;
                        return categoryMatch && yearMatch;
                    });

                    videoList.innerHTML = '';
                    if (filteredVideos.length === 0) {
                        videoList.innerHTML = '<p class="text-center col-span-full">該当する動画がありません。</p>';
                        return;
                    }

                    const sortedVideos = filteredVideos.sort((a, b) => new Date(b.published_date) - new Date(a.published_date));

                    sortedVideos.forEach((video, index) => {
                        const videoId = getYouTubeVideoId(video.url);
                        if (videoId) {
                            const videoCard = `
                                <div class="video-card card-hover-effect relative bg-slate-800/80 rounded-lg shadow-lg overflow-hidden transform hover:-translate-y-1 transition-all duration-300" data-aos="fade-up" data-aos-delay="${index * 50}">
                                    <div class="relative pt-[56.25%] bg-black">
                                        <iframe class="absolute top-0 left-0 w-full h-full" src="https://www.youtube.com/embed/${videoId}" title="YouTube video player" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe>
                                    </div>
                                    <div class="p-6">
                                        <h3 class="text-xl font-semibold mb-2 text-white">${video.title}</h3>
                                        <p class="text-slate-400 text-sm">公開日: ${video.published_date}</p>
                                    </div>
                                </div>
                            `;
                            videoList.insertAdjacentHTML('beforeend', videoCard);
                        }
                    });
                }

                if (categoryFilterContainer) {
                    categoryFilterContainer.addEventListener('click', (e) => {
                        if (e.target.tagName !== 'BUTTON') return;
                        currentCategory = e.target.dataset.filter;
                        categoryFilterContainer.querySelector('.active').classList.remove('active');
                        e.target.classList.add('active');
                        renderVideos();
                    });
                }

                if (yearFilterButton) {
                    yearFilterButton.addEventListener('click', (e) => {
                        e.stopPropagation();
                        yearFilterOptions.classList.toggle('hidden');
                        yearFilterButton.querySelector('i').classList.toggle('rotate-180');
                    });
                }

                if (yearFilterOptions) {
                    yearFilterOptions.addEventListener('click', (e) => {
                        if (e.target.tagName !== 'BUTTON') return;
                        currentYear = e.target.dataset.filter;
                        yearFilterLabel.textContent = e.target.textContent;
                        yearFilterOptions.classList.add('hidden');
                        yearFilterButton.querySelector('i').classList.remove('rotate-180');
                        renderVideos();
                    });
                }

                document.addEventListener('click', (e) => {
                    if (yearFilterContainer && !yearFilterContainer.contains(e.target) && yearFilterOptions && !yearFilterOptions.classList.contains('hidden')) {
                        yearFilterOptions.classList.add('hidden');
                        yearFilterButton.querySelector('i').classList.remove('rotate-180');
                    }
                });
            }
        });

        function parseCSV(text) {
            const lines = text.trim().split(/\r\n|\n/);
            if (lines.length <= 1) return [];

            const header = lines[0].split(',').map(h => h.trim());
            const categoryMap = { '歌フル': 'uta-full', '歌ショート': 'uta-short', 'イラスト': 'illust' };
            const titleIndex = header.indexOf('タイトル');
            const dateIndex = header.indexOf('公開日');
            const urlIndex = header.indexOf('URL');
            const categoryIndex = header.indexOf('動画カテゴリ');

            return lines.slice(1).map(line => {
                if (line.trim() === '') return null;
                const regex = /(?:"([^"]*(?:""[^"]*)*)"|([^,]*))(?:,|$)/g;
                let values = [];
                let match;
                while ((match = regex.exec(line)) && match[0] !== '') {
                    let value = match[1] ? match[1].replace(/""/g, '"') : match[2];
                    values.push(value.trim());
                }
                if (values.length < header.length) return null;

                const entry = {};
                entry.title = values[titleIndex] || '';
                entry.published_date = values[dateIndex] || '';
                entry.url = urlIndex < values.length ? values[urlIndex] : '';
                const categoryJP = categoryIndex < values.length ? values[categoryIndex] : '';
                entry.category = categoryMap[categoryJP] || '';
                return entry;
            }).filter(Boolean);
        }

        function getYouTubeVideoId(url) {
            if (!url) return '';
            let videoId = '';
            try {
                if (url.includes('/shorts/')) {
                    videoId = new URL(url).pathname.split('/shorts/')[1];
                } else if (url.includes('watch?v=')) {
                    videoId = new URL(url).searchParams.get('v');
                } else if (url.includes('youtu.be/')) {
                    videoId = new URL(url).pathname.substring(1);
                } else if (url.includes('/embed/')) {
                    videoId = new URL(url).pathname.split('/embed/')[1];
                }
            } catch (e) {
                console.error("URLの解析に失敗しました:", url, e);
                const match = url.match(/([a-zA-Z0-9_-]{11})/g);
                if (match) return match[match.length - 1];
                return '';
            }
            return videoId ? videoId.split('?')[0].substring(0, 11) : '';
        }
    </script>
</body>
</html>

